// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Book {
  code       String     @id @default(uuid())
  title      String
  author     String
  year       DateTime
  belongs_to String
  status     BookStatus
  user       User       @relation("created_by", fields: [created_by], references: [cpf])
  created_by String     @unique

  Operation   Operation? @relation(fields: [operationId], references: [id])
  operationId String?

  @@map("books")
}

enum BookStatus {
  AVAILABLE
  RESERVED
  BORROWED
}

model Operation {
  id           String        @id @default(uuid())
  createdAt    DateTime      @default(now())
  expectedDate DateTime      @default(dbgenerated("(now() + (if(type === 'RESERVE') '1 day'::interval '14 days'::interval))"))
  finalDate    DateTime?     @updatedAt
  books        Book[]
  user         User?         @relation("created_by", fields: [createdBy], references: [cpf])
  createdBy    String?       @unique
  type         OperationType
}

enum OperationType {
  RESERVE
  LOAN
}

model User {
  cpf            String     @id @default(uuid())
  email          String     @unique
  password       String
  name           String
  code           String
  phone          String
  birth_date     DateTime
  street_name    String
  street_type    StreetType
  house_number   String
  complements    String?
  neighborhood   String
  city           String
  state          String
  cep            Int
  institution    String
  created_by     User?      @relation("created_by", fields: [cpf_created_by], references: [cpf])
  cpf_created_by String?    @unique
  teste2         User?      @relation("created_by")
  teste          Book?      @relation("created_by")
  teste3         Operation? @relation("created_by")
  role           Role       @default(STUDENT)

  @@map("users")
}

enum Role {
  STUDENT
  EMPLOYEE
  ADMIN
}

enum StreetType {
  AEROPORTO
  ALAMEDA
  AREA
  AVENIDA
  CAMPO
  CHACARA
  COLONIA
  CONDOMINIO
  CONJUNTO
  DISTRITO
  ESPLANADA
  ESTACAO
  ESTRADA
  FAVELA
  FAZENDA
  FEIRA
  JARDIM
  LADEIRA
  LAGO
  LAGOA
  LARGO
  LOTEAMENTO
  MORRO
  NUCLEO
  PARQUE
  PASSARELA
  PATIO
  PRACA
  QUADRA
  RECANTO
  RESIDENCIAL
  RODOVIA
  RUA
  SETOR
  SITIO
  TRAVESSA
  TRECHO
  TREVO
  VALE
  VEREDA
  VIA
  VIADUTO
  VIELA
  VILA
}
